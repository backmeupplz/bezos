// Dependencies
import { Telegraf, ContextMessageUpdate } from 'telegraf'
import { getRaffleByWinnerId } from '../models/raffle';
import { getRaffleBalance } from '../helpers/Ethereum';

// Start and help commands
export function setupStartAndHelp(bot: Telegraf<ContextMessageUpdate>) {
  bot.command(['start', 'help'], async (ctx) => {
    // Prepare text
    let text = `–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –∫—É–ø–∏—Ç—å —Ä–µ–∫–ª–∞–º—É –Ω–∞ –∫–∞–Ω–∞–ª–µ @${process.env.CHANNEL_HANDLE}. –£—Å–ª–æ–≤–∏—è –ø—Ä–æ—Å—Ç—ã:\n\n‚Ä¢ –†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç–µ–∫—Å—Ç —Ä–µ–∫–ª–∞–º—ã —Å—é–¥–∞ –∏ Ethereum –Ω–∞ –ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å –≤–≤–æ–¥–∞\n‚Ä¢ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10 —É—Ç—Ä–∞ –ø–æ –ú–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –Ω–∞ @${process.env.CHANNEL_HANDLE} –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Ä–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –Ω–∞—á–∞–ª–∞ –æ—á–µ—Ä–µ–¥–∏ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ —É–±—ã–≤–∞–Ω–∏—é –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤.\n‚Ä¢ –ï—Å–ª–∏ –≤–∞—à —Ç–µ–∫—Å—Ç –Ω–µ –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —Å–µ–≥–æ–¥–Ω—è, —Ç–æ –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å, –µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –≤–≤–µ–¥–µ—Ç –±–æ–ª—å—à–µ Ethereum, —á–µ–º –≤—ã (—Å—É–º–º—ã –≤–≤–æ–¥–∞ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å).\n‚Ä¢ –î–æ–≤–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–π Ethereum –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç ‚Äî –æ–Ω –ø—Ä–∏–±–∞–≤–∏—Ç—Å—è –∫ –≤–∞—à–µ–π —Ç–µ–∫—É—â–µ–π —Å—É–º–º–µ –≤–≤–æ–¥–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π —Ä–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç.\n‚Ä¢ –í–∞—à–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –≤ –∏—Ç–æ–≥–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–ª—É—á–∞–π–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∞–∫—Ç–∏–≤–Ω–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É —Å–ø—É—Å—Ç—è —Å—É—Ç–∫–∏ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤–∞—à–µ–π —Ä–µ–∫–ª–∞–º—ã.\n\n/help ‚Äî —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n/ad <code>—Ä–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç</code> ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –±–æ—Ç—É –≤ –æ—á–µ—Ä–µ–¥—å (–∑–∞–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Ä–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç). –í –≤–∞—à–µ–º —Ä–µ–∫–ª–∞–º–Ω–æ–º —Ç–µ–∫—Å—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –æ—Ñ—Ñ–µ—Ä –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –∫–∞–Ω–∞–ª–∞ ‚Äî –∏–Ω–∞—á–µ —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω.\n/info ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –æ—á–µ—Ä–µ–¥–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ (–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–º —Å—É–º–º–∞–º —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π), –≤–∞—à–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥–∏, –≤–∞—à–µ–º –∞–¥—Ä–µ—Å–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–µ–∫—É—â–µ–º –±–∞–ª–∞–Ω—Å–µ, —Ç–µ–∫—É—â–µ–º —Ä–µ–∫–ª–∞–º–Ω–æ–º —Ç–µ–∫—Å—Ç–µ.\n\n–ö–æ–¥ –±–æ—Ç–∞ <a href="https://github.com/backmeupplz/bezos">–≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ</a> (–∑–≤–µ–∑–¥—ã —Å—Ç–∞–≤–∏—Ç—å –º–æ–∂–Ω–æ –∏ –Ω—É–∂–Ω–æ).`
    // Check if winner
    const raffle = await getRaffleByWinnerId(ctx.from.id)
    if (raffle) {
      // Check balance
      const balance = await getRaffleBalance(raffle)
      if (balance >= Number(process.env.MIN_ETH)) {
        text = `${text}\n\nüéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${balance} ETH! –ß—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å —Å–≤–æ–π –≤—ã–∏–≥—Ä—ã—à, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ä–≤–∞—Ä–¥ —Å–æ–æ–±—â–µ–Ω–∏—è, –∞ –∏–º–µ–Ω–Ω–æ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ) –∫–æ—à–µ–ª—å–∫–æ–º Ethereum. –û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏—Ç–µ @borodutch.`
      }
    }
    // Reply
    ctx.replyWithHTML(text)
  })
}